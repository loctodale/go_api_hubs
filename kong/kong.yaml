_format_version: "3.0"
services:
  - name: account-service
    host: account-service
    port: 8080
    protocol: grpc
    routes:
      - name: account-route
        strip_path: false
        paths:
          - /account
        plugins:
          - name: grpc-gateway
            config:
              proto: /account/proto/account.proto
      - name: private-account-route
        strip_path: false
        paths:
          - /private/account
        plugins:
          - name: grpc-gateway
            config:
              proto: /account/proto/account.proto
          - name: jwt
            config:
              key_claim_name: sub
              header_names:
                - authorization
          - name: acl
            config:
              allow:
                - member
  - name: apis-service
    host: apis-service
    port: 8080
    protocol: grpc
    routes:
      - name: apis-route
        strip_path: false
        paths:
          - /apis/private
          - /plan/private
          - /api_keys/private
        plugins:
          - name: grpc-gateway
            config:
              proto: /apis/proto/apis.proto
          - name: jwt
            config:
              key_claim_name: sub
              header_names:
                - authorization
          - name: acl
            config:
              allow:
                - member
  - name: payment-service
    host: payment-service
    port: 8080
    protocol: grpc
    routes:
      - name: payment-route
        strip_path: false
        paths:
          - /wallet
        plugins:
          - name: grpc-gateway
            config:
              proto: /payment/proto/payment.proto
          - name: jwt
            config:
              key_claim_name: sub
              header_names:
                - authorization
          - name: acl
            config:
              allow:
                - member
                - provider
  - name: request-logs-service
    host: request-logs-service
    port: 8080
    protocol: grpc
    routes:
      - name: request-logs-route
        strip_path: false
        paths:
          - /request_logs
        plugins:
          - name: grpc-gateway
            config:
              proto: /request-logs/proto/request_logs.proto
          - name: jwt
            config:
              key_claim_name: sub
              header_names:
                - authorization
          - name: acl
            config:
              allow:
                - member
                - provider